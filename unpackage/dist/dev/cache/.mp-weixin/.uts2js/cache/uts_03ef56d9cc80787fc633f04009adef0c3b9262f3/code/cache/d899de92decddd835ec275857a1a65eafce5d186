{"code":"import { defineComponent } from \"vue\";\n/**\n * DataChecklist 数据选择器\n * @description 通过数据渲染的下拉框组件\n * @tutorial https://uniapp.dcloud.io/component/uniui/uni-data-select\n * @property {String} value 默认值\n * @property {Array} localdata 本地数据 ，格式 [{text:'',value:''}]\n * @property {Boolean} clear 是否可以清空已选项\n * @property {Boolean} emptyText 没有数据时显示的文字 ，本地数据无效\n * @property {String} label 左侧标题\n * @property {String} placeholder 输入框的提示文字\n * @property {Boolean} disabled 是否禁用\n * @property {String} placement 弹出位置\n * \t@value top   \t\t顶部弹出\n * \t@value bottom\t\t底部弹出（default)\n * @event {Function} change  选中发生变化触发\n */\nexport default defineComponent({\n    name: \"uni-data-select\",\n    mixins: [uniCloud.mixinDatacom || {}],\n    props: {\n        localdata: new UTSJSONObject({\n            type: Array,\n            default() {\n                return [];\n            }\n        }),\n        value: new UTSJSONObject({\n            type: [String, Number],\n            default: ''\n        }),\n        modelValue: new UTSJSONObject({\n            type: [String, Number],\n            default: ''\n        }),\n        label: new UTSJSONObject({\n            type: String,\n            default: ''\n        }),\n        placeholder: new UTSJSONObject({\n            type: String,\n            default: '请选择'\n        }),\n        emptyTips: new UTSJSONObject({\n            type: String,\n            default: '无选项'\n        }),\n        clear: new UTSJSONObject({\n            type: Boolean,\n            default: true\n        }),\n        defItem: new UTSJSONObject({\n            type: Number,\n            default: 0\n        }),\n        disabled: new UTSJSONObject({\n            type: Boolean,\n            default: false\n        }),\n        // 格式化输出 用法 field=\"_id as value, version as text, uni_platform as label\" format=\"{label} - {text}\"\n        format: new UTSJSONObject({\n            type: String,\n            default: ''\n        }),\n        placement: new UTSJSONObject({\n            type: String,\n            default: 'bottom'\n        })\n    },\n    data() {\n        return {\n            showSelector: false,\n            current: '',\n            mixinDatacomResData: [],\n            apps: [],\n            channels: [],\n            cacheKey: \"uni-data-select-lastSelectedValue\",\n        };\n    },\n    created() {\n        this.debounceGet = this.debounce(() => {\n            this.query();\n        }, 300);\n        if (this.collection && !this.localdata.length) {\n            this.debounceGet();\n        }\n    },\n    computed: {\n        typePlaceholder() {\n            const text = new UTSJSONObject({\n                'opendb-stat-app-versions': '版本',\n                'opendb-app-channels': '渠道',\n                'opendb-app-list': '应用'\n            });\n            const common = this.placeholder;\n            const placeholder = text[this.collection];\n            return placeholder ?\n                common + placeholder :\n                common;\n        },\n        valueCom() {\n            return this.modelValue;\n        },\n        textShow() {\n            // 长文本显示\n            let text = this.current;\n            return text;\n        },\n        getOffsetByPlacement() {\n            switch (this.placement) {\n                case 'top':\n                    return \"bottom:calc(100% + 12px);\";\n                case 'bottom':\n                    return \"top:calc(100% + 12px);\";\n            }\n        }\n    },\n    watch: {\n        localdata: {\n            immediate: true,\n            handler(val = null, old = null) {\n                if (Array.isArray(val) && old !== val) {\n                    this.mixinDatacomResData = val;\n                }\n            }\n        },\n        valueCom(val = null, old = null) {\n            this.initDefVal();\n        },\n        mixinDatacomResData: {\n            immediate: true,\n            handler(val = null) {\n                if (val.length) {\n                    this.initDefVal();\n                }\n            }\n        },\n    },\n    methods: new UTSJSONObject({\n        debounce(fn = null, time = 100) {\n            let timer = null;\n            return function (...args) {\n                if (timer)\n                    clearTimeout(timer);\n                timer = setTimeout(() => {\n                    fn.apply(this, args);\n                }, time);\n            };\n        },\n        // 执行数据库查询\n        query() {\n            this.mixinDatacomEasyGet();\n        },\n        // 监听查询条件变更事件\n        onMixinDatacomPropsChange() {\n            if (this.collection) {\n                this.debounceGet();\n            }\n        },\n        initDefVal() {\n            let defValue = '';\n            if ((this.valueCom || this.valueCom === 0) && !this.isDisabled(this.valueCom)) {\n                defValue = this.valueCom;\n            }\n            else {\n                let strogeValue = null;\n                if (this.collection) {\n                    strogeValue = this.getCache();\n                }\n                if (strogeValue || strogeValue === 0) {\n                    defValue = strogeValue;\n                }\n                else {\n                    let defItem = '';\n                    if (this.defItem > 0 && this.defItem <= this.mixinDatacomResData.length) {\n                        defItem = this.mixinDatacomResData[this.defItem - 1].value;\n                    }\n                    defValue = defItem;\n                }\n                if (defValue || defValue === 0) {\n                    this.emit(defValue);\n                }\n            }\n            const def = this.mixinDatacomResData.find(item => { return item.value === defValue; });\n            this.current = def ? this.formatItemName(def) : '';\n        },\n        /**\n         * @param {[String, Number]} value\n         * 判断用户给的 value 是否同时为禁用状态\n         */\n        isDisabled(value = null) {\n            let isDisabled = false;\n            this.mixinDatacomResData.forEach(item => {\n                if (item.value === value) {\n                    isDisabled = item.disable;\n                }\n            });\n            return isDisabled;\n        },\n        clearVal() {\n            this.emit('');\n            this.current = '';\n            if (this.collection) {\n                this.removeCache();\n            }\n        },\n        change(item = null) {\n            if (!item.disable) {\n                this.showSelector = false;\n                this.current = this.formatItemName(item);\n                this.emit(item.value);\n            }\n        },\n        emit(val = null) {\n            this.$emit('input', val);\n            this.$emit('update:modelValue', val);\n            this.$emit('change', val);\n            if (this.collection) {\n                this.setCache(val);\n            }\n        },\n        toggleSelector() {\n            if (this.disabled) {\n                return null;\n            }\n            this.showSelector = !this.showSelector;\n        },\n        formatItemName(item = null) {\n            let text = item.text, value = item.value, channel_code = item.channel_code;\n            channel_code = channel_code ? `(${channel_code})` : '';\n            if (this.format) {\n                // 格式化输出\n                let str = \"\";\n                str = this.format;\n                for (let key in item) {\n                    str = str.replace(new RegExp(`{${key}}`, \"g\"), item[key]);\n                }\n                return str;\n            }\n            else {\n                return this.collection.indexOf('app-list') > 0 ?\n                    `${text}(${value})` :\n                    (text ?\n                        text :\n                        `未命名${channel_code}`);\n            }\n        },\n        // 获取当前加载的数据\n        getLoadData() {\n            return this.mixinDatacomResData;\n        },\n        // 获取当前缓存key\n        getCurrentCacheKey() {\n            return this.collection;\n        },\n        // 获取缓存\n        getCache(name = this.getCurrentCacheKey()) {\n            let cacheData = uni.getStorageSync(this.cacheKey) || new UTSJSONObject({});\n            return cacheData[name];\n        },\n        // 设置缓存\n        setCache(value = null, name = this.getCurrentCacheKey()) {\n            let cacheData = uni.getStorageSync(this.cacheKey) || new UTSJSONObject({});\n            cacheData[name] = value;\n            uni.setStorageSync(this.cacheKey, cacheData);\n        },\n        // 删除缓存\n        removeCache(name = this.getCurrentCacheKey()) {\n            let cacheData = uni.getStorageSync(this.cacheKey) || new UTSJSONObject({});\n            delete cacheData[name];\n            uni.setStorageSync(this.cacheKey, cacheData);\n        },\n    })\n});\n//# sourceMappingURL=D:/xiaochengxu/xiangmu1/xiangmu111/uni_modules/uni-data-select/components/uni-data-select/uni-data-select.vue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.setStorageSync"],"map":"{\"version\":3,\"file\":\"uni-data-select.vue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"uni-data-select.vue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
